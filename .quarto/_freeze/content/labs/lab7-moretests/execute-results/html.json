{
  "hash": "85e95de041eab0a352371fb0d8f430a7",
  "result": {
    "markdown": "---\ntitle: \"Lab 7: More hypothesis testing\"\nauthor: \"STAT218\"\nauthor-title: \"Course activity\"\nexecute: \n  eval: true\n  results: 'markup'\nformat: \n  html:\n    toc: true\n  docx:\n    toc: false\nprefer-html: true\nembed-resources: true\n---\n\n\nThe objective of this lab is to learn how to perform $t$-tests for a population mean in R. We will cover:\n\n-   specifying null and alternative hypotheses\n-   interpreting R output\n\n## Datasets\n\nThroughout this lab we'll use the datasets:\n\n-   `sleep` are 135 observations of average hours of sleep per night from NHANES respondents\n\nYou'll need to run the commands below in order to load these datasets before proceeding with the activity.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(oibiostat)\n\ndata(nhanes.samp.adult)\nsleep <- nhanes.samp.adult$SleepHrsNight\nstr(sleep)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n int [1:135] 9 3 6 6 6 6 6 4 7 4 ...\n```\n:::\n:::\n\n\nBy way of review, you'll recall from last time that hypothesis tests are performed in R using `t.test()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# do US adults sleep either more or less than 8 hours a night? [result: yes]\nt.test(sleep, mu = 8, alternative = 'two.sided')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tOne Sample t-test\n\ndata:  sleep\nt = -9.1966, df = 134, p-value = 6.328e-16\nalternative hypothesis: true mean is not equal to 8\n95 percent confidence interval:\n 6.658933 7.133659\nsample estimates:\nmean of x \n 6.896296 \n```\n:::\n\n```{.r .cell-code}\n# do US adults sleep more than 8 hours a night? [result: no]\nt.test(sleep, mu = 8, alternative = 'greater')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tOne Sample t-test\n\ndata:  sleep\nt = -9.1966, df = 134, p-value = 1\nalternative hypothesis: true mean is greater than 8\n95 percent confidence interval:\n 6.69752     Inf\nsample estimates:\nmean of x \n 6.896296 \n```\n:::\n\n```{.r .cell-code}\n# do US adults sleep less than 8 hours a night? [result: yes]\nt.test(sleep, mu = 8, alternative = 'less')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tOne Sample t-test\n\ndata:  sleep\nt = -9.1966, df = 134, p-value = 3.164e-16\nalternative hypothesis: true mean is less than 8\n95 percent confidence interval:\n     -Inf 7.095073\nsample estimates:\nmean of x \n 6.896296 \n```\n:::\n:::\n\n\n::: callout-tip\n## Choosing your alternative wisely\n\nIt can be tricky to pick alternatives in directional tests. Suppose you want to test whether adults sleep less than 8 hours. Should you use an upper-sided or a lower-sided test?\n\nConsider the difference in interpretation between the upper-sided ($p \\approx 1$) and lower-sided ($p \\approx 0$) tests above:\n\n-   \\[upper sided test fails to reject\\] the data *do not* provide evidence that U.S. adults *don't* sleep less then 8 hours a night\n-   \\[lower sided test rejects\\] the data provide evidence that U.S. adults don't sleep more than 8 hours a night, and favor instead the alternative that they sleep less than 8 hours a night\n\nBoth answers are consistent with adults sleeping less than 8 hours, but they frame the question in different ways, and the results are not logically equivalent: the former is a double negative and basically inconclusive; the latter is a stronger conclusion.\n\nIf you want to answer the question whether adults sleep less than 8 hours, the better way to do it is with a lower-sided test, so that you potentially find evidence for the claim of interest (should you reject the upper-sided test) rather than potentially fail to find evidence against the claim of interest.\n\nThe best rule of thumb for choosing the null and alternative in a direction test is: *the null should be the claim you hope to refute, and the alternative should be the claim you hope to support with evidence*.\n:::\n\n## Reporting test results\n\nHere you'll practice reporting test results. You'll work with a group on just *one* of the questions below, and your objective is to write a complete report of the test outcome:\n\n-   hypotheses tested\n-   test conclusion, interpreted in context\n-   test statistic, degrees of freedom, $p$-value\n-   confidence interval and point estimate, interpreted in context\n\nThese elements should be summarized together in complete sentences; see the lecture slides for a complete example. Be sure to consider how to frame the hypotheses appropriately to answer the question (see remark above on choosing alternatives).\n\n1.  Do US adults sleep 7.5 hours per night on average?\n2.  Do US adults sleep less than 7.5 hours per night on average?\n3.  Do US adults sleep more than 7.5 hours per night on average?\n4.  Do US adults sleep more than 6.5 hours per night on average?\n\n::: callout-note\n## Your turn\n\nWork with your group to answer one of the four questions above. Use significance level $\\alpha = 0.05$ to make a decision.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. Do US adults sleep 7.5 hours per night on average?\n\n# 2. Do US adults sleep less than 7.5 hours per night on average?\n\n# 3. Do US adults sleep more than 7.5 hours per night on average?\n\n# 4. Do US adults sleep more than 6.5 hours per night on average?\n```\n:::\n\n\nWrite a complete report of the test results.\n:::\n\n## Changing the confidence level\n\nYou will have noticed by now that `t.test` produces a confidence interval. The interval calculated is designed to match the test in the following sense:\n\n- a lower-sided test produces a lower confidence bound $\\bar{x} - c\\times SE(\\bar{x})$\n- an upper-sided test produces an upper confidence bound $\\bar{x} + c\\times SE(\\bar{x})$\n- a two-sided test produces the usual interval $\\bar{x} \\pm c\\times SE(\\bar{x})$\n\nIn each case, the critical value $c$ is chosen to provide a specific coverage. It will *not* be the same in each formula above, even for the same coverage level.\n\n**The test rejects at level $\\alpha$ just in case the interval excludes the null value $\\mu_0$**. To change the confidence level, add the argument `conf.level = ...` to the `t.test` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# a 99% interval\nt.test(sleep, mu = 8, alternative = 'two.sided', conf.level = 0.99)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tOne Sample t-test\n\ndata:  sleep\nt = -9.1966, df = 134, p-value = 6.328e-16\nalternative hypothesis: true mean is not equal to 8\n99 percent confidence interval:\n 6.582703 7.209890\nsample estimates:\nmean of x \n 6.896296 \n```\n:::\n\n```{.r .cell-code}\n# an 80% interval\nt.test(sleep, mu = 8, alternative = 'two.sided', conf.level = 0.8)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tOne Sample t-test\n\ndata:  sleep\nt = -9.1966, df = 134, p-value = 6.328e-16\nalternative hypothesis: true mean is not equal to 8\n80 percent confidence interval:\n 6.741733 7.050860\nsample estimates:\nmean of x \n 6.896296 \n```\n:::\n:::\n\n\n::: callout-note\n## Your turn\n\nCompute an upper 87% confidence bound for the mean nightly hours of sleep for U.S. adults. Interpret the interval in context.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# fill in the '...' parts to obtain an 87% upper confidence bound\nt.test(sleep, \n       mu = ...,\n       alternative = ...,\n       conf.level = ...)\n```\n:::\n\n:::\n\n## Exploring decision errors\n\nThere are two ways to make an error in a hypothesis test.\n\n![](img/testing-errors.png){width=\"400\"}\n\nWe can explore type I error rates by testing a hypothesis known to be true; we can explore type II error rates by testing a hypothesis known to be false. To do so, let's again pretend that the following 3,179 NHANES survey responses are a population.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload('data/nhanes.RData')\n\n# \"true\" population mean\npop_mean <- mean(nhanes$TotChol)\n```\n:::\n\n\n### Type I errors\n\nA type I error is rejecting a true null hypothesis. To explore the rate of type I errors, let's test the following:\n\n$$H_0: \\mu = 5.043$$ $$H_A: \\mu \\neq 5.043$$\n\n5.043 is the *true population mean*, so in point of fact $H_0$ is true and we should *not* reject; any rejections are therefore type I errors. We'll all generate a sample from 3,179 observations of total HDL cholesterol. Each of us will obtain a different sample. Using our respective samples, we'll each test whether the population mean is 5.043 and see how many of us produce an erroneous conclusion. This will provide a sense of the error rate.\n\nTo start, run these commands:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# draw a sample \nsamp <- sample(nhanes$TotChol, size = 20)\n\n# test a true null\nt.test(samp, mu = pop_mean, alternative = 'two.sided')\n```\n:::\n\n\nRecall that test decisions depend on the rule: reject if $p < \\alpha$. Let's tally type I errors for different significance levels $\\alpha$:\n\n| Significance level | Error frequency |\n|--------------------|-----------------|\n| $\\alpha = 0.2$     |                 |\n| $\\alpha = 0.1$     |                 |\n| $\\alpha = 0.05$    |                 |\n| $\\alpha = 0.02$    |                 |\n\nWe should see that the type I error rate is approximately equal to the significance level. The significance level is, in fact, a cap on type I error.\n\n### Type II errors\n\nNow let's test whether the population mean is some $\\mu_0 \\neq 5.043$. In this case, $H_0$ will be false, and a correct decision is to reject $H_0$. Any failures to reject will be considered type II errors.\n\nTry running the following.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# draw a sample \nsamp <- sample(nhanes$TotChol, size = 20)\n\n# test a false null\nt.test(samp, \n       mu = 4.2, # change this for exercise\n       alternative = 'two.sided')\n```\n:::\n\n\nThe error rate will depend on how far the null hypothesis is from the truth. Presumably, if we test that $\\mu = 5.044$, we'll have a high type II error rate because the null value is so close to the truth; this hypothesis would be very hard to refute. If, on the other hand, we test $\\mu = 0$, we whould have a low type II error rate because the null value is far from the truth. Let's use significance level $\\alpha = 0.05$ throughout and tally errors for several different null values:\n\n| Null value $\\mu_0$ | Error frequency |\n|--------------------|-----------------|\n| 4.2                |                 |\n| 4.6                |                 |\n| 4.9                |                 |\n| 5.1                |                 |\n| 5.4                |                 |\n| 5.7                |                 |\n\nNotice that the type II error is quite high for null values near the true mean; this is because the test prioritizes avoiding type I errors, and as a result has little power to detect such alternatives.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}