{
  "hash": "554a44b4163051725b282e971c10273d",
  "result": {
    "markdown": "---\ntitle: \"Lab 4: Sampling variability\"\nauthor: \"STAT218\"\nauthor-title: \"Course activity\"\nexecute: \n  eval: true\n  results: 'hide'\nformat: \n  html:\n    toc: true\n  docx:\n    toc: false\nprefer-html: true\nembed-resources: true\n---\n\n\nIn this lab you'll explore sampling variation. There are two learning goals:\n\n1. Demonstrate through simulation the variability of summary statistics, particularly the mean, across random samples.\n2. Explore the effect of sample size on sampling variability.\n\nWe'll use 3,179 responses to the 2009-2010 NHANES and consider specifically the total cholesterol variable. We will treat these observations as a population, and simulate the effect of sampling on summary statistics by generating small to moderate subcollections of observations drawn at random without replacement.\n\nThe dataset has been stored as a separate file `nhanes.RData`. Load the dataset, extract the variable of interest, and preview the first handful of observations using the commands below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load nhanes dataset\nload('data/nhanes.RData')\n\n# extract total cholesterol column\ncholesterol <- nhanes$TotChol\n\n# view summary\nstr(cholesterol)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n num [1:3179] 3.49 3.49 3.49 6.7 5.82 5.82 5.82 4.99 4.24 6.41 ...\n```\n:::\n:::\n\n\nSince we are pretending that these 3,179 respondents form a population, we can examine the population distribution of the cholesterol variable and also calculate population statistics.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# numeric summary\nsummary(cholesterol)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  2.330   4.240   4.970   5.043   5.690  13.650 \n```\n:::\n\n```{.r .cell-code}\n# compute population mean and sd\npop_mean <- mean(cholesterol)\npop_sd <- sd(cholesterol)\n\n# construct histogram\nhist(cholesterol, breaks = 30)\nabline(v = pop_mean, col = 4, lty = 2)\n```\n\n::: {.cell-output-display}\n![](lab4-sampling_files/figure-html/population summaries-1.png){width=672}\n:::\n:::\n\n\n## Exploring sampling variability\n\nThe commands below will draw a sample, compute the mean and standard deviation, and compare them with the corresponding population values.\n\n- does the histogram look similar to the population distribution?\n- do the sample statistics closely align with the population values?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# draw a sample -- try running this line a few times\nsample(cholesterol, size = 50, replace = F)\n\n# now store a sample\nsamp <- sample(cholesterol, size = 50)\n\n# calculate mean and sd\nsamp_mean <- mean(samp)\nsamp_sd <- sd(samp)\nsamp_mean\nsamp_sd\n\n# estimation error\nsamp_mean - pop_mean\nsamp_sd - pop_sd\n\n# make a histogram\nhist(samp, breaks = 10)\n\n# add lines at sample mean and population mean\nabline(v = samp_mean, col = 2) # red line\nabline(v = pop_mean, col = 4, lty = 2) # blue line\n```\n:::\n\n\nBecause you are drawing a random sample, results will differ each time you run the above commands. Likewise, results will differ from your groupmates.\n\n::: callout-note\n## Your turn\n\nRun the lines above and compare results with your group. Manually enter your means and standard deviations in a vector. Repeat and add entries until you have at least 6 sample means and 6 standard deviations. Discuss:\n\n1. Does it appear that the sample statistics tend to be close to the population values?\n2. Do the sample statistics vary much across samples? How might you measure this using your simulated means and standard deviations?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# make vectors of 6 or more means and standard deviations\nsamp_means <- ...\nsamp_sds <- ...\n\n# calculate errors\nsamp_means - pop_mean\nsamp_sds - pop_sd\n\n# how would you measure variability?\n```\n:::\n\n:::\n\n## Effect of sample size\n\nNow let's explore how sample size affects sampling variation of summary statistics.\n\nFirst let's examine how the frequency distribution of a single sample changes when we increase the sample size. Notice that the histogram of the larger sample more closely matches the population distribution.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# population distribution\nhist(cholesterol, breaks = 30)\n```\n\n::: {.cell-output-display}\n![](lab4-sampling_files/figure-html/comparing frequency distributions-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# small sample size (try running a few times)\nhist(sample(cholesterol, size = 50), breaks = 15)\n```\n\n::: {.cell-output-display}\n![](lab4-sampling_files/figure-html/comparing frequency distributions-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# large sample size (try running a few times)\nhist(sample(cholesterol, size = 1000), breaks = 20)\n```\n\n::: {.cell-output-display}\n![](lab4-sampling_files/figure-html/comparing frequency distributions-3.png){width=672}\n:::\n:::\n\n\nWe should therefore expect that summary statistics more closely approximate population values for larger samples. Our measure of sampling variability reflects this expectation. Recall that the theoretical standard deviation of the sample mean is:\n$$ SD(\\bar{x}) = \\frac{\\sigma}{\\sqrt{n}} \n\\quad\\left(\\frac{\\text{population SD}}{\\sqrt{\\text{sample size}}}\\right)$$\n\nThis will diminish as $n$ increases, indicating less sampling variation for larger samples. Let's explore that empirically.\n\nThe commands below simulate `nsim` samples of size `n` and calculate the mean of each sample. Don't worry about understanding the code that creates `samp_means`; your job is to use the results to measure sampling variability. First run this without any changes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# number of samples to simulate\nnsim <- 1000\n\n# this generates nsim sample means from samples of size 10\nsamp_means_10 <- sapply(1:nsim,\n                     function(i){\n                       mean(sample(cholesterol, size = 10))\n                     })\n\n# repeat, but for samples of size 100\nsamp_means_100 <- sapply(1:nsim,\n                     function(i){\n                       mean(sample(cholesterol, size = 100))\n                     })\n\n\n# inspect\nstr(samp_means_10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n num [1:1000] 4.99 4.89 5.18 5.08 5.45 ...\n```\n:::\n\n```{.r .cell-code}\nstr(samp_means_100)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n num [1:1000] 5.14 5.01 5.18 5.13 4.96 ...\n```\n:::\n:::\n\n\nEffectively, you've just simulated a sampling distribution for the mean cholesterol of a sample of size 10 by generating means from lots of random samples. Notice already the additional variability for the smaller sample size --- the means seem to deviate more often by a larger amount from the population value.\n\n::: callout-note\n## Your turn\n\nNow try using your simulated means to measure the sampling variability of the mean; compare this with the theoretical standard deviation.\n\nDo this for both the $n = 10$ and $n = 100$ cases. What changes?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# calculate standard deviation of simulated means\nsim_sd_10 <- ...\n\n# calculate theoretical standard deviation\ntheory_sd_10 <- ...\n\n# calculate average error\navg_error_10 <- ...\n\n# calculate standard deviation of simulated means\nsim_sd_100 <- ...\n\n# calculate theoretical standard deviation\ntheory_sd_100 <- ...\n\n# calculate average error\navg_error_100 <- ...\n```\n:::\n\n:::\n\nTake note of the fact that in practice, it would not be possible to simulate sampling distributions in this way, because you'd lack data for a complete population. In practice, you'll only have *one* sample, and will need to use this to estimate the sampling variability based on theory. \n\nThe simulations above don't provide an actionable method for estimating sampling variability, but are rather an exercise to aid in understanding exactly what theoretical estimates of sampling variability are designed to measure.\n\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "lab4-sampling_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}