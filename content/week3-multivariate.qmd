---
title: "Bivariate summaries"
subtitle: "Quantitative and graphical techniques for summarizing two variables"
format: 
  revealjs:
    logo: img/poly-logo-2.jpg
    footer: "STAT218"
    smaller: true
    mermaid:
      theme: neutral
execute: 
  echo: false
  warning: false
  message: false
---

## Today's agenda

```{r}
library(oibiostat)
library(tidyverse)
library(pander)
data(famuss)
```

1.  HW discussion

2.  Reading quiz \[[2pm section](https://forms.office.com/r/BTsqQQLRqX)\] \[[4pm section](https://forms.office.com/r/GsSRY4e5VD)\]

3.  (Univariate) Measures of spread

4.  Graphical summmaries for two variables

    -   numeric/numeric
    -   numeric/categorical
    -   categorial/categorical

5.  Lab: bivariate graphics in R

## Measures of spread

The *spread* of observations refers to how concentrated or diffuse the values are.

```{r, fig.width = 8, fig.height = 2.5, fig.align='center'}
par(mfrow = c(1, 2))
par(mar = c(1, 1, 4, 1),
    cex.main = 2)
curve(dnorm, from = -3, to = 3, 
      main = 'more spread', 
      xaxt = 'n', 
      yaxt = 'n',
      xlab = '',
      ylab = '')
curve(dnorm(x, sd = 0.25), from = -3, to = 3, 
      main = 'less spread', 
      xaxt = 'n', 
      yaxt = 'n',
      xlab = '',
      ylab = '')
```

Two ways to understand and measure spread:

-   *ranges* of values capturing much of the distribution
-   *deviations* of values from a central value

## Range-based measures

A simple way to understand and measure spread is based on ranges. Consider more ages, sorted and ranked:

```{r}
x <- c(16, 18, 19, 20, 21, 22, 25, 26, 28, 29, 30, 34)
rbind(age = x, rank = rank(x)) %>% pander()
```

-   The **range** is the difference \[maximum value\] - \[minimum value\] $$\text{range} = 34 - 16 = 18$$

-   The **interquartile range** (IQR) is the difference \[75th percentile\] - \[25th percentile\] $$\text{IQR} = 29 - 19 = 10$$ *When might you prefer IQR to range? Can you think of an example?*

## Deviation-based measures

Another way is based on *deviations* from a central value. Continuing the example, the mean age is is 24. The deviations of each observation from the mean are:

```{r}
ages <- c(16, 18, 19, 20, 21, 22, 25, 26, 28, 29, 30, 34)

rbind(age = ages, deviation = ages - mean(ages)) %>% pander()
```

The **average deviation** is defined as the average of the absolute values of the deviations from the mean: $$\frac{8 + 6 + 5 + 4 + 3 + 2 + 1 + 2 + 4 + 5 + 6}{12}$$

The **standard deviation** is defined in terms of the squared deviations from the mean: $$\sqrt{\frac{(-8)^2 + (-6)^2 + (-5)^2 + (-4)^2 + (-3)^2 + (-2)^2 + (1)^2 + (2)^2 + (4)^2 + (5)^2 + (6)^2}{12 - 1}}$$

## Mathematical notations

::: columns
::: {.column width="65%"}
Denote $n$ observations of a variable $x$ by $x_1, \dots, x_n$, so that $x_i$ indicates the value of the $i$th observation. Our ages:

```{r}
ages %>% pander()
```

Applying the notation at right:

| $i$                 | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  | 12  |
|---------------------|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|
| $x_i$               |     |     |     |     |     |     |     |     |     |     |     |     |
| $x_i - \bar{x}$     |     |     |     |     |     |     |     |     |     |     |     |     |
| $(x_i - \bar{x})^2$ |     |     |     |     |     |     |     |     |     |     |     |     |
:::

::: {.column width="35%"}
The **mean** of the observations is written: $$\bar{x} = \frac{1}{n}\sum_i x_i$$

The **standard deviation** is: $$s_x = \sqrt{\frac{1}{n - 1}\sum_i (x_i - \bar{x})^2}$$
:::
:::

*How would you write the formula for calculating average deviation using this notation?*

## Interpretations

Listed from largest to smallest, here are each of the measures of spread for the 12 ages:

```{r}
c(range = diff(range(ages)),
  iqr = IQR(ages),
  st.dev = sd(ages),
  avg.dev = mean(abs(ages - mean(ages)))) %>%
  pander()
```

The interpretations differ between these statistics:

-   \[range\] all of the data lies on an interval of 18 years
-   \[IQR\] the middle half of the data lies on an interval of 8.5 years
-   \[average deviation\] the average distance from the mean is 4.67 years
-   \[standard deviation\] the average squared distance from the mean, rescaled to years, is 5.53 years

## Robustness

The IQR is more robust than any of the other measures, because outliers only affect extreme percentiles.

::: columns
::: {.column width="40%"}
Consider adding an observation of 94 to our 12 ages:

```{r, echo = T}
# initial range
range(ages)

# append an outlier
ages_add <- c(ages, 94)

# relative change in IQR
(IQR(ages_add) - IQR(ages))/IQR(ages)

# relative change in SD
(sd(ages_add) - sd(ages))/sd(ages)
```
:::

::: {.column width="60%"}
The effect of the outlier on each measure is captured by the ratio $\frac{\text{measure with outlier}}{\text{measure without outlier}}$, which shows:

-   the IQR increases by 5.88%
-   the standard deviation increases by 264%
:::
:::

## Limitations of univariate summaries

So far we have discussed **univariate** descriptive techniques --- those that pertain to one variable at a time. Consider, for example, the height and weight of participants in the FAMuSS study:

::: columns
::: {.column width="70%"}
```{r, fig.width=8, fig.height = 4}
library(oibiostat)
data(famuss)
height <- famuss$height
weight <- famuss$weight

par(mfrow = c(1, 2))
par(mar = c(5, 5, 3, 1),
    cex.main = 2, cex.lab = 2, cex.axis = 1.5)
hist(height)
abline(v = mean(height), col = 2, lwd = 2)
hist(weight)
abline(v = mean(weight), col = 2, lwd = 2)
```
:::

::: {.column width="30%"}
-   both unimodal, no obvious outliers
-   heights symmetric
-   weights right-skewed
-   but these observations actually come in *pairs*
:::
:::

*The summaries we know how to make don't reflect how the variables might be related.*

## Bivariate summaries

Bivariate (and by extension multivariate) summaries are graphical or numerical descriptions that represent two (or more) variables *jointly*.

::: columns
::: {.column width="60%"}
A simple example is a scatterplot:

```{r, fig.width=5, fig.height=4}
par(mar = c(5, 5, 1, 1),
    cex.main = 2, cex.lab = 2, cex.axis = 1.5)
plot(height, weight)
points(mean(height), mean(weight), col = 2, pch = 17, cex = 2)
abline(v = mean(height), h = mean(weight), col = 2, lwd = 2, lty = 2)
```
:::

::: {.column width="40%"}
Each point represents a pair of values $(h, w)$ for one study participant.

-   Reveals a relationship: taller participants tend to be heavier
-   But no longer shows individual distributions clearly

Notice, though, that the marginal means (dashed red lines) still capture the center well.
:::
:::

## Summary types

Bivariate summary techniques differ depending on the data types of the variables being compared. Some examples the context of the FAMuSS study:

| Question                                                                                                   | Comparison              |
|------------------------------------------------------------------------------------------------------------|-------------------------|
| Did genotype frequencies differ by race or sex among study participants?                                   | categorical/categorical |
| Were differential changes in arm strength observed according to genotype?                                  | numeric/categorical     |
| Did change in arm strength appear related in any way to body size among study participants?                | numeric/numeric         |
| Did study participants experience similar or different changes in arm strength depending on arm dominance? | *??*                    |

## Categorical/categorical

<!-- *Did genotype frequencies differ by sex among study participants?* -->

A **contingency table** is a bivariate tabular summary of two categorical variables; it shows the frequency of each pair of values. Usually the marginal totals are also shown.

```{r}
tbl <- table(famuss$sex, famuss$actn3.r577x) 

cbind(tbl, total = rowSums(tbl)) %>%
  rbind(total = c(colSums(tbl), sum(tbl))) %>%
  pander()
```

There are multiple ways to convert to proportions by using different denominators:

-   grand total
-   row total
-   column total

Each has a different interpretation and should be chosen according to the question of interest.

## Categorical/categorical

*Did genotype frequencies differ by sex among study participants?*

For this question, the **row totals** should be used to see the genotype composition of each sex.

::: columns
::: {.column width="50%"}
As a table:

```{r}
tbl_rowsums <- (tbl/rowSums(tbl)) 
tbl_rowsums %>% pander()
```
:::

::: {.column width="50%"}
As a graphic:

```{r}
par(mar = c(3, 2, 1, 1), cex = 2)
barplot(t(tbl_rowsums), horiz = T, legend.text = T)
```
:::
:::

The proportions are quite close, suggesting minimal sex differences.

## Categorical/categorical

*Did sex frequencies differ by genotype among study participants?*

For this question, the **column totals** should be used to see the sex composition of each genotype.

::: columns
::: {.column width="50%"}
As a table:

```{r}
tbl_colsums <- (t(tbl)/colSums(tbl))  %>% t() 
tbl_colsums %>% pander()
```
:::

::: {.column width="50%"}
As a graphic:

```{r}
par(mar = c(3, 2, 1, 1),
    cex = 2)
barplot(tbl_colsums, legend.text = c('M', 'F'))
```
:::
:::

The proportions are close, suggesting minimal genotype differences.

## Numeric/numeric

*Did change in arm strength appear related in any way to body size among study participants?*

Comparing numeric variables is easiest accomplished by scatterplots.

```{r}
par(mfrow = c(2, 3),
    mar = c(2, 5, 1, 1),
    cex = 1.5)
plot(famuss$height, famuss$ndrm.ch, xlab = '', ylab = 'nondominant', main = 'height')
plot(famuss$weight, famuss$ndrm.ch, xlab = '', ylab = '', main = 'weight')
plot(famuss$bmi, famuss$ndrm.ch, xlab = '', ylab = '', main = 'bmi')
plot(famuss$height, famuss$drm.ch, xlab = '', ylab = 'dominant', main = '')
plot(famuss$weight, famuss$drm.ch, xlab = '', ylab = '', main = '')
plot(famuss$bmi, famuss$drm.ch, xlab = '', ylab = '', main = '')

```

## Correlation

In addition to graphical techniques, for numeric/numeric comparisons, there are also quantiative measures of relationship.

::: columns
::: {.column width="60%"}
![](img/correlations.png){width="600"}
:::

::: {.column width="40%"}
**Correlation** measures the strength of linear relationship, and is defined as: $$r_{xy} = \frac{1}{n - 1}\frac{\sum_i (x_i - \bar{x})(y_i - \bar{y})}{s_x s_y}$$

-   $r \rightarrow 1$: *positive* relationship
-   $r \rightarrow -1$: *negative* relationship
-   $r \rightarrow 0$: no relationship
:::
:::

## Uncorrelated $\neq$ no relationship

Correlation only captures *linear* relationships. Always do a graphical check.

![](img/more-correlations.png){width="700"}

Common misconceptions:

-   stronger correlation $\longleftrightarrow$ greater slope
-   weaker correlation $\longleftrightarrow$ no relationship

## Interpreting correlations

*Did change in arm strength appear related in any way to body size among study participants?*

Here are the correlations corresponding to the plots we checked earlier.

```{r}
cor_mx <- famuss %>%
  select(drm.ch, ndrm.ch, height, weight, bmi) %>%
  cor()

cor_mx[3:5, 1:2] %>%
  t() %>%
  pander()
```

So there aren't any linear relationships here. A rule of thumb:

-   $|r| < 0.3$: no relationship
-   $0.3 \leq |r| < 0.6$: weak to moderate relationship
-   $0.6 \leq |r| < 1$: moderate to strong relationship
-   $|r| = 1$: either a mistake or not real data

## Numeric/categorical

Side-by-side boxplots are usually a good option. Avoid stacked histograms.

*Were differential changes in arm strength observed according to genotype?*

::: columns
::: {.column width="80%"}
```{r, fig.width = 8, fig.height = 4}
par(mfrow = c(1, 2),
    mar = c(5, 5, 3, 1),
    cex = 1)
boxplot(ndrm.ch ~ actn3.r577x, 
        data = famuss, 
        horizontal = T,
        range = 2,
        main = 'nondominant',
        xlab = 'percent change', 
        ylab = 'genotype')
boxplot(drm.ch ~ actn3.r577x, 
        data = famuss, 
        horizontal = T,
        range = 2,
        main = 'dominant',
        xlab = 'percent change', 
        ylab = 'genotype')
```
:::

::: {.column width="20%"}
Look for differences:

-   location shift
-   spread
-   center

*What do you think? Any notable relationships?*
:::
:::
